<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gmail Energy Monitor</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <h1>Gmail Energy Monitor</h1>
      </div>
      <div id="loading" class="loading" style="display:none;">Loading...</div>
    </div>

    <!-- Login Section -->
    <div id="loginSection" class="login-section" style="display: none; flex: 1; padding: 40px 30px;">
      <img src="images/icon48.png" alt="Logo" class="logo">

      <h2>Track Your Email Footprint</h2>
      <p>Authorize Gmail to begin monitoring energy & CO‚ÇÇ.</p>
      <button id="loginBtn" class="btn btn-primary" style="box-shadow: 0 6px 16px rgba(88, 155, 84, 0.3); padding: 14px 36px; font-size: 15px;">Login with Gmail</button>
    </div>


    <!-- Main Section -->
    <div id="mainSection" style="display: none;">
          <div class="title-section">
        <h2>What would you like to view?</h2>
      </div>

      <div class="button-group">
        <button class="nav-btn" data-view="overview">Overview</button>
        <button class="nav-btn" data-view="mailbox">Mailbox</button>
        <button class="nav-btn" data-view="tips">Tips</button>
      </div>

      <div class="action-bar">
        <button id="refreshBtn" class="btn btn-refresh">Refresh</button>
        <button id="exportBtn" class="btn btn-export">Export CSV</button>
        <button id="formulaBtn" class="btn btn-formula">Formula</button>
      </div>

      <!-- Overview Tab -->
      <div id="overview" class="tab-content">
        <!-- Today's Summary Cards -->
         <h3 style="padding: 12px 20px 0; margin: 0; font-size: 14px; color: #666;">Today's Activity (Since Midnight)</h3>

        <div class="today-cards">
          <div class="today-card">
            <h4>ENERGY</h4>
            <p class="today-value" id="todayEnergy">0 Wh</p>
          </div>
          <div class="today-card">
            <h4>CO‚ÇÇ</h4>
            <p class="today-value" id="todayCO2">0 g</p>
          </div>
          <div class="today-card">
            <h4>EMAILS</h4>
            <p class="today-value" id="todayEmails">0</p>
          </div>
          <div class="today-card">
            <h4>DATA</h4>
            <p class="today-value" id="todayData">0 MB</p>
          </div>
        </div>
        <!-- Today's Hourly Chart -->
        <div class="chart-container">
          <h3>Today (24 Hours) - Energy & CO‚ÇÇ</h3>
          <div class="chart-box">
            <canvas id="todayHourlyChart"></canvas>
          </div>
        </div>

        <h3 style="padding: 12px 20px 0;">Weekly Trend - Energy & CO‚ÇÇ</h3>

        <div class="kpi-grid">
          <div class="kpi-card">
            <h3>Avg CO‚ÇÇ / Day</h3>
            <p class="kpi-value" id="avgCO2Day">0 g</p>
          </div>
          <div class="kpi-card">
            <h3>Weekly Energy</h3>
            <p class="kpi-value" id="weeklyEnergy">0 Wh</p>
          </div>
        </div>

        <!-- By Week Chart -->
        <div class="chart-container" style="padding: 0px 5px 0;">
           <h3>Weekly Trend - Energy & CO‚ÇÇ</h3>
          <div class="chart-box">
            <canvas id="dailyBarChart"></canvas>
          </div>
        </div>

        <div class="kpi-card equivalent-card">
          <h3>
            Weekly Equivalent
          </h3>
          <p style="font-size: 10px; color: #F57F17; margin: 0 0 8px 0;">(Your 7-day CO‚ÇÇ equals...)</p>
          <div class="equivalent-list">
            <div class="equiv-item">
              <span class="equiv-icon">üì±</span>
              <span class="equiv-label">Phone charges</span>
              <span class="equiv-value" id="equivPhone">0</span>
            </div>
            <div class="equiv-item">
              <span class="equiv-icon">üí°</span>
              <span class="equiv-label">LED bulb hours</span>
              <span class="equiv-value" id="equivLED">0 hrs</span>
            </div>
            <div class="equiv-item">
              <span class="equiv-icon">üöó</span>
              <span class="equiv-label">Car driving</span>
              <span class="equiv-value" id="equivCar">0 m</span>
            </div>
            <div class="equiv-item">
              <span class="equiv-icon">üå≥</span>
              <span class="equiv-label">Tree absorbs in</span>
              <span class="equiv-value" id="equivTree">0 min</span>
            </div>
          </div>
        </div>


        <p id="limitWarning" class="limit-warning" style="display:none;">
          Warning: >500 new emails ‚Äì size stats partial
        </p>
      </div>

      <!-- Mailbox Tab -->
      <div id="mailbox" class="tab-content">
        <p style="font-size: 12px; color: #666; margin: 12px 20px 0; font-style: italic; margin-bottom: 20px;">
         Showing inbox activity since first login: <strong id="firstLoginDateMailbox">--</strong>
      </p>
        <div class="stats-grid">
          <div class="stat-card"><h3>Total</h3><p class="stat-value" id="totalEmails">0</p></div>
          <div class="stat-card"><h3>Unread</h3><p class="stat-value" id="unreadEmails">0</p></div>
          <div class="stat-card"><h3>Sent</h3><p class="stat-value" id="sentEmails">0</p></div>
          <div class="stat-card"><h3>Received</h3><p class="stat-value" id="receivedEmails">0</p></div>
          <div class="stat-card"><h3>Attachments</h3><p class="stat-value" id="totalAttachments">0</p></div>
          <div class="stat-card"><h3>Avg Size</h3><p class="stat-value" id="avgEmailSize">0 KB</p></div>
          <div class="stat-card"><h3>Spam</h3><p class="stat-value" id="spamEmails">0</p></div>
          <div class="stat-card"><h3>Spam Unread</h3><p class="stat-value" id="spamUnreadEmails">0</p></div>
          <div class="stat-card"><h3>Spam Size</h3><p class="stat-value" id="spamSizeMB">0 MB</p></div>

        </div>
        <div class="breakdown">
          <p><strong>Total Data:</strong> <span id="totalData">0 MB</span></p>
          <p><strong>Largest:</strong> <span id="largestEmail">0 KB</span></p>
          <p><strong>Smallest:</strong> <span id="smallestEmail">0 KB</span></p>
        </div>
        <div class="breakdown" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #eee;">
        <h4 style="font-size: 13px; color: var(--green-dark); margin-bottom: 10px;">‚ö†Ô∏è Spam Impact</h4>
        <p><strong>Spam CO2 Equivalent:</strong></p>
        <div style="display: flex; gap: 12px; font-size: 11px;">
          <span>üì± <span id="spamEquivPhone">0</span> phone charges</span>
          <span>üöó <span id="spamEquivCar">0</span> km driving</span>
        </div>
      </div>

      </div>

      <!-- Tips Tab -->
      <div id="tips" class="tab-content">
          <div class="tips-list" id="personalizedTips">
              <!-- JS injection -->
          </div>
      </div>

      <!-- Cumulative Chart -->
      <div id="cumulativeSection" class="cumulative-section">
         <h3>Cumulative Tracking</h3>
         <canvas id="cumulativeChart"></canvas>
         <p class="first-login" id="firstLoginLabel">First login: --</p>
      </div>
    </div>

    <!-- Formula Tab -->
  <div id="formula" class="tab-content">
    <div class="formula-section">
      <h3>Calculation Formulas</h3>
    
      <!-- CO2 Emissions Card -->
      <div class="formula-card">
        <h4>CO‚ÇÇ Emissions (grams)</h4>
        <div class="formula-box">
          CO‚ÇÇ (g) = [New Emails √ó 0.3] + [Attachment MB √ó 4.2] + [Stored GB √ó 30 √∑ 365]
        </div>
        
        <ul class="equiv-list" style="margin: 8px 0;">
          <li><strong>New Emails:</strong> 0.3g CO2e per email (transmission + device)</li>
          <li><strong>Attachments:</strong> 4.2g CO2e per MB (data transmission + storage)</li>
          <li><strong>Storage:</strong> 30g CO2e per GB per year (spread across 365 days)</li>
        </ul>
      </div>
    
      <!-- Energy Consumption Card - CORRECTED -->
      <div class="formula-card">
        <h4> Energy Consumption (Watt-hours)</h4>
        <div class="formula-box">
          Energy (Wh) = [CO‚ÇÇ (g) √∑ 445] √ó 1,000
        </div>
        <p class="formula-source">
          <strong>Explanation:</strong> 445 g CO2/kWh is the global grid carbon intensity (2024). 
          Divide CO‚ÇÇ by 445 to get kWh, then multiply by 1,000 to convert to Wh.
        </p>
      </div>
    
      <!-- Key Metrics Card -->
      <div class="formula-card">
        <h4>Key Metrics (2024-2025)</h4>
        <ul class="equiv-list">
          <li><strong>Email Transmission:</strong> 0.3g CO2e per email sent/received</li>
          <li><strong>Attachment Data:</strong> 4.2g CO2e per MB</li>
          <li><strong>Storage Cost:</strong> 30g CO2e per GB per year</li>
          <li><strong>Grid Carbon Intensity:</strong> 445 g CO2/kWh (global average)</li>
        </ul>
        <p class="formula-source">
          <strong>Sources:</strong> Berners-Lee (2020), Towards Data Science (2025), Greenly (2024), IEA (2024)
        </p>
      </div>
    
      <!-- Real-World Equivalents Card -->
      <div class="formula-card">
        <h4>Real-World CO‚ÇÇ Equivalents (2024)</h4>
        <ul class="equiv-list">
          <li><strong>üì± Phone Charge (full):</strong> 8g CO2e</li>
          <li><strong>üí° LED Bulb (10W, 1 hour):</strong> 4.45g CO2e</li>
          <li><strong>üöó Car Driving:</strong> 170g CO2e per kilometer</li>
          <li><strong>üå≥ Tree CO2 Absorption:</strong> 0.046g CO2e per minute</li>
        </ul>
        <p class="formula-source">
          <strong>Sources:</strong> EPA (2024), IEA (2024), European Environment Agency
        </p>
      </div>

      <div class="formula-card" style="background: #FFF3E0; border-left-color: #FF9800;">
        <h4>Spam Emails - Do They Count?</h4>
        <p class="formula-source">
          Spam is fully included in  CO2 calculations. The energy was consumed when it arrived. Deleting it won't reduce past emissions, but unsubscribing prevents future ones.
        </p>
      </div>
    
      <!-- What Doesn't Affect Emissions -->
      <div class="formula-card" style="background: #FFF3E0; border-left-color: #FF9800;">
        <h4>‚ö†Ô∏è What DOESN'T Affect Emissions</h4>
        <ul class="equiv-list">
          <li><strong>Unread Status:</strong> Marking emails as read/unread uses no additional energy</li>
          <li><strong>Trash Folders:</strong> Deleted emails DON'T reduce CO2 (energy already used when received)</li>
          <li><strong>Moving Emails:</strong> Moving between folders doesn't affect emissions</li>
        </ul>
      </div>
    </div>

  </div>

  </div>

  <script src="chart.min.js"></script>
  <script src="popup.js"></script>
</body>
</html>
